# Involution Engine - Environment Configuration Template
# Copy this file to .env and customize for your deployment

# =============================================================================
# ENGINE SERVICE CONFIGURATION
# =============================================================================

# Service Environment
ENV=production                           # dev, test, staging, production
DEBUG=0                                  # Enable debug endpoints (0=disabled, 1=enabled) - NEVER enable in production
SERVICE_VERSION=2.0.0                   # Service version identifier

# Server Configuration
HOST=0.0.0.0                            # Bind address (0.0.0.0 for all interfaces)
PORT=8000                               # Service port
WORKERS=4                               # Number of gunicorn workers (2 * CPU cores recommended)
WORKER_TIMEOUT=30                       # Request timeout in seconds
WORKER_CLASS=uvicorn.workers.UvicornWorker  # Worker class for async support

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# CORS Settings (Critical for production security)
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com  # Comma-separated list - NEVER use * in production
ALLOWED_METHODS=GET,POST                 # Allowed HTTP methods
ALLOWED_HEADERS=content-type,authorization,x-request-id  # Allowed request headers
ALLOW_CREDENTIALS=true                   # Whether to allow credentials in CORS requests

# Rate Limiting (Prevent abuse)
RATE_LIMIT_STORAGE_URI=redis://redis:6379/0  # Redis URI for rate limiting storage
RATE_LIMIT_DEFAULT=100/minute            # Default rate limit per IP
RATE_LIMIT_CALCULATE=60/minute           # Rate limit for calculation endpoints
RATE_LIMIT_TIMESOLVE=30/minute          # Rate limit for time resolution endpoints
DISABLE_RATE_LIMIT=0                    # Disable rate limiting (1=disabled) - Only for testing/CI

# API Security
API_KEY_HEADER=X-API-Key                # Header name for API key authentication (if implemented)
REQUIRE_API_KEY=0                       # Require API key for access (0=disabled, 1=enabled)
TRUSTED_PROXIES=127.0.0.1,::1          # Comma-separated list of trusted proxy IPs

# =============================================================================
# SPICE KERNEL CONFIGURATION
# =============================================================================

# Kernel Management
METAKERNEL_PATH=kernels/involution.tm   # Path to SPICE metakernel file
KERNEL_SET_TAG=2024-Q3                  # Kernel set version identifier
KERNEL_DOWNLOAD_URL=https://naif.jpl.nasa.gov/pub/naif/generic_kernels/  # Base URL for kernel downloads
KERNEL_VERIFICATION=strict              # Kernel verification mode (strict, lenient, disabled)

# Ephemeris Configuration
DE_EPHEMERIS=DE440                      # DE ephemeris version (DE440, DE441)
EPHEMERIS_COVERAGE_START=1550-01-01     # Start of ephemeris coverage
EPHEMERIS_COVERAGE_END=2650-01-01       # End of ephemeris coverage

# =============================================================================
# TIME RESOLVER CONFIGURATION
# =============================================================================

# Time Resolver Service
TIME_RESOLVER_URL=http://time-resolver:5000  # URL for time resolver service
TIME_RESOLVER_TIMEOUT=10                # Timeout for time resolver requests (seconds)
TIME_RESOLVER_RETRY_ATTEMPTS=3          # Number of retry attempts for failed requests

# Timezone Database
TZDB_VERSION=latest                     # TZDB version to use (latest, specific version)
TZDB_UPDATE_CHECK=daily                 # How often to check for TZDB updates
TIMEZONE_CACHE_TTL=3600                 # Timezone lookup cache TTL (seconds)

# Historical Accuracy
DEFAULT_PARITY_PROFILE=strict_history   # Default time resolution parity profile
HISTORICAL_PATCHES_ENABLED=true        # Enable historical timezone patches
US_PRE1967_PATCHES=true                # Enable pre-1967 US timezone patches

# =============================================================================
# GEOCODING CONFIGURATION
# =============================================================================

# Nominatim Geocoding Service
NOMINATIM_URL=http://nominatim:8080     # Nominatim service URL
NOMINATIM_TIMEOUT=10                    # Request timeout (seconds)
NOMINATIM_USER_AGENT=involution-engine/2.0.0  # User agent for requests
GEOCODING_CACHE_TTL=86400               # Geocoding cache TTL (24 hours)

# Geocoding Limits
MAX_GEOCODING_REQUESTS_PER_DAY=1000     # Daily geocoding request limit
GEOCODING_RATE_LIMIT=10/minute          # Rate limit for geocoding requests

# =============================================================================
# DATABASE CONFIGURATION (if applicable)
# =============================================================================

# PostgreSQL (for user data, caching, etc.)
DATABASE_URL=postgresql://user:password@postgres:5432/involution  # Full database URL
DB_HOST=postgres                        # Database host
DB_PORT=5432                           # Database port
DB_NAME=involution                     # Database name
DB_USER=involution_user                # Database username
DB_PASSWORD=secure_random_password_here # Database password - CHANGE THIS
DB_SSL_MODE=require                    # SSL mode (disable, allow, prefer, require, verify-ca, verify-full)
DB_POOL_SIZE=10                        # Connection pool size
DB_MAX_OVERFLOW=20                     # Maximum pool overflow

# Redis (for caching and rate limiting)
REDIS_URL=redis://redis:6379/0         # Redis connection URL
REDIS_HOST=redis                       # Redis host
REDIS_PORT=6379                        # Redis port
REDIS_DB=0                             # Redis database number
REDIS_PASSWORD=                        # Redis password (if required)
REDIS_SSL=false                        # Use SSL for Redis connection

# =============================================================================
# LOGGING AND MONITORING
# =============================================================================

# Logging Configuration
LOG_LEVEL=INFO                          # Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_FORMAT=json                         # Log format (json, text)
LOG_FILE=/var/log/involution/app.log    # Log file path (if file logging enabled)
LOG_ROTATION=daily                      # Log rotation (daily, weekly, size-based)
LOG_RETENTION_DAYS=30                   # Log retention period

# Structured Logging
ENABLE_REQUEST_LOGGING=true             # Log all HTTP requests
ENABLE_CALCULATION_LOGGING=true         # Log calculation details
ENABLE_PERFORMANCE_LOGGING=true         # Log performance metrics
LOG_SENSITIVE_DATA=false                # Log sensitive data (coordinates, times) - DISABLE in production

# Monitoring and Metrics
METRICS_ENABLED=true                    # Enable metrics collection
METRICS_ENDPOINT=/metrics               # Metrics endpoint path
PROMETHEUS_PUSHGATEWAY_URL=             # Prometheus pushgateway URL (optional)
HEALTH_CHECK_INTERVAL=30                # Health check interval (seconds)

# =============================================================================
# PERFORMANCE AND SCALING
# =============================================================================

# Caching
ENABLE_POSITION_CACHE=true              # Cache calculated positions
POSITION_CACHE_TTL=3600                 # Position cache TTL (1 hour)
ENABLE_AYANAMSA_CACHE=true              # Cache ayanamsa calculations
AYANAMSA_CACHE_TTL=86400                # Ayanamsa cache TTL (24 hours)

# Request Processing
MAX_REQUEST_SIZE=1048576                # Maximum request size (1MB)
REQUEST_TIMEOUT=30                      # Request timeout (seconds)
KEEP_ALIVE_TIMEOUT=5                    # Keep-alive timeout (seconds)
MAX_CONCURRENT_REQUESTS=100             # Maximum concurrent requests

# Memory and Resource Limits
MAX_MEMORY_USAGE=2048                   # Maximum memory usage (MB)
SPICE_KERNEL_MEMORY_LIMIT=512           # SPICE kernel memory limit (MB)
CALCULATION_TIMEOUT=10                  # Individual calculation timeout (seconds)

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Backup Configuration
BACKUP_ENABLED=true                     # Enable automated backups
BACKUP_SCHEDULE=0 2 * * *               # Backup schedule (cron format - daily at 2 AM)
BACKUP_RETENTION_DAYS=30                # Backup retention period
BACKUP_STORAGE_PATH=/var/backups/involution  # Local backup storage path
BACKUP_S3_BUCKET=                       # S3 bucket for remote backups (optional)

# Kernel Backup
KERNEL_BACKUP_ENABLED=true              # Backup SPICE kernels
KERNEL_INTEGRITY_CHECK=daily            # Kernel integrity check frequency

# =============================================================================
# EXTERNAL INTEGRATIONS
# =============================================================================

# Notification Services
SLACK_WEBHOOK_URL=                      # Slack webhook for alerts (optional)
EMAIL_SMTP_HOST=                        # SMTP host for email alerts
EMAIL_SMTP_PORT=587                     # SMTP port
EMAIL_SMTP_USER=                        # SMTP username
EMAIL_SMTP_PASSWORD=                    # SMTP password
EMAIL_FROM_ADDRESS=alerts@yourdomain.com  # From address for alerts

# Error Tracking
SENTRY_DSN=                             # Sentry DSN for error tracking (optional)
SENTRY_ENVIRONMENT=production           # Sentry environment
SENTRY_SAMPLE_RATE=0.1                  # Sentry sample rate

# =============================================================================
# DEVELOPMENT AND TESTING
# =============================================================================

# Development Settings (DO NOT USE IN PRODUCTION)
DEV_RELOAD=false                        # Enable auto-reload for development
DEV_CORS_ALLOW_ALL=false                # Allow all origins in CORS (dangerous)
DEV_DISABLE_AUTH=false                  # Disable authentication (dangerous)
DEV_MOCK_TIME_RESOLVER=false            # Mock time resolver responses

# Testing
TEST_MODE=false                         # Enable test mode
TEST_DATA_PATH=tests/data               # Path to test data
GENERATE_TEST_REPORTS=true              # Generate detailed test reports

# =============================================================================
# SECURITY HEADERS AND HARDENING
# =============================================================================

# Security Headers
ENABLE_SECURITY_HEADERS=true            # Enable security headers middleware
HSTS_MAX_AGE=31536000                   # HTTP Strict Transport Security max age
CSP_POLICY=default-src 'self'           # Content Security Policy
X_CONTENT_TYPE_OPTIONS=nosniff          # X-Content-Type-Options header
X_FRAME_OPTIONS=DENY                    # X-Frame-Options header
REFERRER_POLICY=strict-origin-when-cross-origin  # Referrer Policy

# TLS Configuration
TLS_VERSION=1.2                         # Minimum TLS version
CIPHER_SUITES=ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM  # Allowed cipher suites
ENABLE_OCSP_STAPLING=true               # Enable OCSP stapling

# =============================================================================
# DEPLOYMENT SPECIFIC
# =============================================================================

# Container Configuration
CONTAINER_NAME=involution-engine        # Container name
RESTART_POLICY=unless-stopped           # Container restart policy
HEALTH_CHECK_COMMAND=curl -f http://localhost:8000/health || exit 1  # Health check command

# Resource Limits
CPU_LIMIT=2.0                           # CPU limit (cores)
MEMORY_LIMIT=4096m                      # Memory limit
DISK_SPACE_LIMIT=10g                    # Disk space limit

# Networking
NETWORK_MODE=bridge                     # Docker network mode
EXPOSE_PORTS=8000:8000                  # Port mapping

# =============================================================================
# NOTES AND WARNINGS
# =============================================================================

# SECURITY WARNINGS:
# 1. NEVER commit .env files with real credentials to version control
# 2. Use strong, unique passwords for all services
# 3. Regularly rotate secrets and API keys
# 4. Enable TLS/SSL for all external communications
# 5. Restrict CORS origins to only necessary domains
# 6. Monitor logs for suspicious activity
# 7. Keep all dependencies updated
# 8. Use secrets management in production (HashiCorp Vault, AWS Secrets Manager, etc.)

# PRODUCTION CHECKLIST:
# [ ] Change all default passwords
# [ ] Configure proper CORS origins
# [ ] Enable rate limiting with Redis
# [ ] Set up monitoring and alerting
# [ ] Configure log aggregation
# [ ] Set up automated backups
# [ ] Enable security headers
# [ ] Configure TLS certificates
# [ ] Set resource limits
# [ ] Test disaster recovery procedures